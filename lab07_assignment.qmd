---
title: "lab07_assignment"
format: 
  html:
    embed-resources: true
editor: visual
---

# Group Assignment Lab 7

s184343 - Lena Schlüter Nielsen

s175357 - Bolette Arildsen

s215008 - Emma Lundsbøl Wernersson

s224373 - Caroline Degner Lundsteen

s211930 - Frederik Allingham de Cordier

## Libraries

```{r}
library(tidyverse)
library(broom)
```

## Load Data

```{r}
#| message: false
biopsy <- read_csv("https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv")
```

## Investigate data

The data is a breast cancer from University of Wisconsin Hospitals, Madison from Dr. William H. Wolberg. It consist of 699 patients and 10 variables. 9 attributes was scored on a scale from 1-10 and the outcome benign/malign is also present.

```{r}
str(biopsy)
```

## Data Wrangling

PCA can only be performed on numerical data, thus only numerical data is selected. Thereby the outcome-variable is removed. Since the PCA captures the variance in data, it must be scaled.\
Last PCA is performed.

```{r}
pca_fit <- biopsy |>
  select(where(is.numeric)) |>
  scale() |>
  prcomp() 
```

## Look at the data in PC coordinates

Looking at the fitted dataset firstly

```{r}
pca_fit
```
As can be seen the dataset has been flattened in accordance with a typical PCA analysis.

This allows us to view the data as a set of PC coordinates and see what connections can be gleamed from doing so, which can be a significantly simpler way of getting a handle on a complex dataset.

###Plotting the data in PC coordinates

```{r}

pca_fit |>
  augment(biopsy) |> # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, color = outcome)) + 
  geom_point(size = 1) +
  scale_color_manual(
    values = c(malignant = "red", benign = "green")
  ) +
  theme_classic() + background_grid()
  
```
As can be seen on the graph above, we have selected the first two principal components and plotted them accordingly. The resulting graph shows a clear correlation between the two components, especially for the benign tumors. The higher the value of PC1 the less likely the tumor is to be malignant and to solidify this prediction one can take the second PC into account as the benign tumors mostly cluster around the value of 0.0.

## Look at the rotation matrix

```{r}
# extract rotation matrix
pca_fit |> 
  tidy(matrix = "rotation")
```
Here we created the rotation matrix and we wish to see how these vectors look when plotted on the same two components as before.
```{r}
# define arrow style for plotting
arrow_style <- arrow(
  angle = 20, ends = "first", type = "closed", length = grid::unit(8, "pt")
)

# plot rotation matrix
pca_fit %>%
  tidy(matrix = "rotation") |> 
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value") |> 
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, yend = 0, arrow = arrow_style) +
  geom_text(
    aes(label = column),
    hjust = 1, nudge_x = -0.02, 
    color = "blue"
  ) +
  xlim(-1.25, .5) + ylim(-.5, 1) +
  coord_fixed() + # fix aspect ratio to 1:1
  theme_minimal_grid(12)
```
Based on the vectors shown here we now know that Mitoses is the key factor for PC2 and thus that PC2 is most likely a measure of something in relation to cell replication. Meanwhile we don't really see any strong connections for PC1 in the present vectors, as all of them are pointing into the negatives.

## Look at the variance explained by each PC

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues")
```
Once again using the tidy function, this time setting the matrix to eigenvalues.
```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues") |> 
  ggplot(aes(PC, percent)) +
  geom_col(fill = "orange", alpha = 0.8) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  ) +
  theme_minimal_hgrid(12)
```

By only using the first PC 65% of the variance is explained. It also becomes clear that adding additional components does not cover a significant amount of variance, and thus it could be argued that running the PCA with the single PC, whilst not optimal, is still doable.
